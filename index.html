<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mes Habitudes Fun</title>
  <meta name="theme-color" content="#ff7eb3">

  <!-- Manifest PWA intégré -->
  <link rel="manifest" href="data:application/manifest+json,{
    &quot;name&quot;:&quot;Mes Habitudes Fun&quot;,
    &quot;short_name&quot;:&quot;Habitudes&quot;,
    &quot;start_url&quot;:&quot;.&quot;,
    &quot;display&quot;:&quot;standalone&quot;,
    &quot;background_color&quot;:&quot;#ff9a9e&quot;,
    &quot;theme_color&quot;:&quot;#ff7eb3&quot;,
    &quot;icons&quot;:[{
      &quot;src&quot;:&quot;https://via.placeholder.com/192&quot;,
      &quot;sizes&quot;:&quot;192x192&quot;,
      &quot;type&quot;:&quot;image/png&quot;
    },{
      &quot;src&quot;:&quot;https://via.placeholder.com/512&quot;,
      &quot;sizes&quot;:&quot;512x512&quot;,
      &quot;type&quot;:&quot;image/png&quot;
    }]
  }">
  
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#fff0f5; color:#333; }
    header { text-align:center; padding:20px; background:#ff7eb3; color:white; }
    #days { display:flex; justify-content:center; gap:10px; margin-top:10px; }
    .day { padding:5px 10px; border-radius:5px; background:#ffe4e1; cursor:default; }
    .day.today { background:#ff4d6d; color:white; font-weight:bold; }
    .category { margin:20px; padding:10px; border-radius:10px; background:#ffd6e8; }
    .category h2 { margin:0 0 10px 0; }
    .habits-container { display:flex; flex-wrap:wrap; gap:10px; }
    .habit { padding:10px; border-radius:5px; background:#fff0f5; cursor:pointer; user-select:none; transition:0.2s; }
    .habit.checked { background:#ff4d6d; color:white; font-weight:bold; }
  </style>
</head>
<body>
  <header>
    <h1>Mes Habitudes ✅</h1>
    <div id="days"></div>
  </header>

  <main>
    <div class="category" data-category="Étirement">
      <h2>🧘 Étirement</h2>
      <div class="habits-container"></div>
    </div>
    <div class="category" data-category="Pompes">
      <h2>💪 Pompes</h2>
      <div class="habits-container"></div>
    </div>
    <div class="category" data-category="Méditation">
      <h2>🧠 Méditation</h2>
      <div class="habits-container"></div>
    </div>
    <div class="category" data-category="Duolingo">
      <h2>🦉 Duolingo</h2>
      <div class="habits-container"></div>
    </div>
    <div class="category" data-category="Rencontre">
      <h2>🤝 Rencontre</h2>
      <div class="habits-container"></div>
    </div>
  </main>

  <script>
    const daysOfWeek = ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];
    const categories = ["Étirement","Pompes","Méditation","Duolingo","Rencontre"];
    const dbName = "habitsDB";
    let db;

    const request = indexedDB.open(dbName,1);
    request.onupgradeneeded = e => {
      db = e.target.result;
      if(!db.objectStoreNames.contains("habits")){
        const store = db.createObjectStore("habits",{ keyPath:"id" });
        store.createIndex("category","category",{ unique:false });
      }
    };
    request.onsuccess = e => { db = e.target.result; initApp(); };

    function initApp(){
      displayDays();
      categories.forEach(category => displayHabits(category));
    }

    function displayDays(){
      const container = document.getElementById("days");
      const todayIndex = new Date().getDay()-1;
      daysOfWeek.forEach((day,index)=>{
        const div=document.createElement("div");
        div.textContent=day;
        div.className="day"+(index===todayIndex?" today":"");
        container.appendChild(div);
      });
    }

    function displayHabits(category){
      const container=document.querySelector(`.category[data-category="${category}"] .habits-container`);
      const today=new Date().toISOString().slice(0,10);
      if(category==="Pompes"){
        [10,20,30].forEach(num=>{
          const btn=document.createElement("div");
          btn.className="habit"; btn.textContent=num;
          btn.onclick=()=>toggleHabit(category,today,num,btn);
          checkHabit(category,today,btn,num);
          container.appendChild(btn);
        });
      }else{
        const btn=document.createElement("div"); btn.className="habit"; btn.textContent="Fait";
        btn.onclick=()=>toggleHabit(category,today,true,btn);
        checkHabit(category,today,btn,true);
        container.appendChild(btn);
      }
    }

    function toggleHabit(category,day,value,element){
      const tx=db.transaction("habits","readwrite");
      const store=tx.objectStore("habits");
      const id=category+"_"+day;
      store.get(id).onsuccess=e=>{
        let data=e.target.result;
        if(category==="Pompes"){
          data={id,category,day,value};
          store.put(data);
          document.querySelectorAll(`.category[data-category="${category}"] .habit`).forEach(btn=>btn.classList.remove("checked"));
          element.classList.add("checked");
        }else{
          if(data){ store.delete(id); element.classList.remove("checked"); }
          else{ store.put({id,category,day,value}); element.classList.add("checked"); }
        }
      };
    }

    function checkHabit(category,day,element,value){
      const tx=db.transaction("habits","readonly");
      const store=tx.objectStore("habits");
      const id=category+"_"+day;
      store.get(id).onsuccess=e=>{
        const data=e.target.result;
        if(data){
          if(category==="Pompes" && data.value===value) element.classList.add("checked");
          else if(category!=="Pompes") element.classList.add("checked");
        }
      };
    }
  </script>
</body>
</html>

